{{export title="quiz"}}

Min<input id="r-min" type="number" min="0" max="200" value="0"/>
Max<input id="r-max" type="number" min="10" max="230" value="230"/>
<button onclick="qmod.nextQuestion()">Go</button>
<div id="question" style="min-height:150px"></div>
<div id="answers" style="min-height:130px"></div>
<div style="clear:both"></div>

		
<script type="module">
import {items} from "/js/items.js";
import {fontMap} from "/js/jsfontmapper.js";
import {QuizManager} from "/js/quiz.js";
import dlite from "/js/domlite.js";

let quizMan = new QuizManager(items);


const dom = {
	minBox : document.getElementById("r-min"),
	maxBox : document.getElementById("r-max"),
	qDiv : document.getElementById("question"),
	aDiv : document.getElementById("answers"),
}

function showSuccess(qData){
	dom.aDiv.innerHTML = '';
	dom.aDiv.append(dlite.tx('Success'));
}

function showMistake(qData){
	dom.aDiv.innerHTML = '';
	dom.aDiv.append(dlite.tx('Error'));
}

function nextQuestion(){
	let qData = quizMan.nextQuestion();

	let mode = Math.floor(qData.active.score / 4);

	let nodes = [];

	{
		let ansNode = dlite.tag('button',
			{
				onclick:()=>{
					quizMan.success(qData);
					showSuccess(qData);
				},
			},
			[modeNode(qData.active,mode)]);
		nodes.push(ansNode);
	}

	nodes.push(...qData.options.map(
		(op,index)=>dlite.tag(
			'button',
			{
				onclick:()=>{
					quizman.mistake(qData,index);
					showMistake(qData);
				}
			},
			[modeNode(op,mode)],
		)
	));
	dom.aDiv.innerHTML = "";
	dom.aDiv.append(...nodes);
	

	dom.qDiv.innerHTML = "";
	dom.qDiv.append( qData.active.
}

//let answers = [];
//let question = [];
function randR(min,max){
	min = Number(min);
	max = Number(max);
	return Math.floor(Math.random() * (max - min)) + min;
}
function rWord(){
	let mn = dom.minBox.value;
	let mx = dom.maxBox.value;
	mx = Math.min(mx ,items.length);
	mn = Math.min(mn ,items.length);
	
	let n = randR(mn,mx);
	return items[n];
}


function shuffle(list){
	for (let i = 0; i < list.length; i++){
		let n = randR(0,list.length);
		let swap = list[i];
		list[i] = list[n];
		list[n] = swap;
	}
}

function inDiv(item){
	let res = document.createElement("div");
	res.appendChild(item);
	return res;
}

function questionNode(item,mode){
	switch (mode){
		case 0 : 
			return dlite.tx(item.name);
		case 1 : 
			return 
	}
}

function optionNode(item,mode){
	switch (mode){
		case 0 : 
			return dlite.tx(fontMap[item.name] ?? `Not in Font Map - ${item.name}`);	
		case 1:
			return dlite.tx(item.name);
		default:
			let node = document.createElement("span");
			node.innerHTML = item.en.join("<br>");
			return node;
	}
}

function answerNode(item){
	return dlite.tag('div',{},[
		dlite.tx'
	])
}

window.qmod = {
	nextQuestion:nextQuestion
};
	

</script>
