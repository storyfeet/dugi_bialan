
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>quiz</title>


<link rel="stylesheet" href="/css/main.css">


<style>


#answers .roman{
	font-size:300%;
	text-align:center;
}

#answers .dugi {
	font-size:400%;
	text-align:center;
}

#answers .en{
	font-size:250%;
	text-align:center;
}


</style>

</head>
<body id="doc_body">
    <div class="page_inner">
        <div id="top_menu" class="no-print menu">
            <a href="/">Home</a>
            <a href="/word_list">Word List</a>
            <a href="/grammar">Grammar</a>
            <a href="/grammar_faq">Grammar Faq</a>
            <a href="/phonology">Phonology</a>
            <a href="/works">Works</a>
            <a href="/dictionary">Dictionary</a>
        </div><div class="title_box">
            <img src="/pics/squares/dugibelan-1.svg">
            <h1>quiz</h1>
        </div><div class="content">
            


<button onclick="qmod.nextQuestion()">Go</button>
<div id="question" style="min-height:150px"></div>
<div id="answers" style="min-height:130px"></div>
<div style="clear:both"></div>

		
<script type="module">
import {items} from "/js/items.js";
import {fontMap} from "/js/jsfontmapper.js";
import {QuizManager} from "/js/quiz.js";
import dlite from "/js/domlite.js";

let quizMan = new QuizManager(items.map((item)=>item.Name));

window.words = [];

const dom = {
	minBox : document.getElementById("r-min"),
	maxBox : document.getElementById("r-max"),
	qDiv : document.getElementById("question"),
	aDiv : document.getElementById("answers"),
}

function loadWord(word){
	if (! window.words[word]){
		let audio = new Audio(`/audio/words/${word}.ogg`);
		window.words[word] = audio;
	}
}

function playWord(word){
	loadWord(word);
	window.words[word].play();
}

function showSuccess(qData){
	playWord(items[qData.active.index].Name);
	dom.aDiv.innerHTML = '';
	dom.aDiv.append(
		dlite.tx('Correct'),
		dlite.br(),
		dlite.tag(
			'button',
			{onclick:()=>nextQuestion() },
			answerNode(items[qData.active.index]),
		),
	);
}

function showMistake(qData){
	playWord(items[qData.active.index].Name);
	dom.aDiv.innerHTML = '';
	dom.aDiv.append(
		dlite.tx('Keep Learning'),
		dlite.br(),
		dlite.tag(
			'button',
			{onclick:()=>nextQuestion()},
			answerNode(items[qData.active.index]),
		),
	);
}

function nextQuestion(){

	let qData = quizMan.nextQuestion();
	
	let {active,options} = qData;
	console.log('Next Question :' ,qData,quizMan.buddyData(active.name));

	let mode = Math.floor(( active.score + 3 ) / 4);

	let nodes = [];

	{
		let ansNode = dlite.tag('button',
			{
				onclick:()=>{
					quizMan.success(qData);
					showSuccess(qData);
				},
			},
			[optionNode(items[active.index],mode)]);
		nodes.push(ansNode);
	}
	if (mode > 0){
		nodes.push(...options.map(
			(op,index)=>dlite.tag(
				'button',
				{
					onclick:()=>{
						quizMan.fail(qData,index);
						showMistake(qData);
					}
				},
				[optionNode(items[op.index],mode)],
			)
		));
	}
	shuffle(nodes);
	dom.aDiv.innerHTML = "";
	dom.aDiv.append(...nodes);
	

	dom.qDiv.innerHTML = "";
	dom.qDiv.append(questionNode(items[active.index],mode));
}

//let answers = [];
//let question = [];
function randR(min,max){
	min = Number(min);
	max = Number(max);
	return Math.floor(Math.random() * (max - min)) + min;
}

function rWord(){
	let mn = dom.minBox.value;
	let mx = dom.maxBox.value;
	mx = Math.min(mx ,items.length);
	mn = Math.min(mn ,items.length);
	
	let n = randR(mn,mx);
	return items[n];
}

function shuffle(list){
	for (let i = 0; i < list.length; i++){
		let n = randR(0,list.length);
		let swap = list[i];
		list[i] = list[n];
		list[n] = swap;
	}
}

function inDiv(item){
	let res = document.createElement("div");
	res.appendChild(item);
	return res;
}

function questionNode(item,mode = 0){
	switch (mode){
		case 0 : 
		case 1 : 
			playWord(item.Name);
			return dlite.tx(item.Name);
		case 2:
			return dlite.tx(fontMap[item.Name] ?? `Not in font map - ${item.Name}`);
	}
}

function optionNode(item,mode){
		
	switch (mode){
		case 0 : 
			return answerNode(item);
		case 1:
			return dlite.span(
				fontMap[item.Name] ?? `Not in Font Map - ${item.Name}`,
				{ className : 'dugi' }
			);	
		case 2:
			return dlite.tx(item.en);
		default:
			let node = document.createElement("span");
			node.innerHTML = item.en.join("<br>");
			return node;
	}
}

function answerNode(item){
	return dlite.table({},[
		dlite.tr({},[
			dlite.td({className:'roman'}, dlite.tx(item.Name)),
			dlite.td({className:'dugi'},fontMap[item.Name]),
		]),
		dlite.tr({},[
			dlite.td({className:'en',colspan:2},dlite.tx(item.en)),
		]),
	]);
}

window.qmod = {
	nextQuestion:nextQuestion
};
	

</script>

        </div>
    </div>

</body>

<script type="module">

function setWideMode(){
    let body = document.getElementById('doc_body');
    if (window.innerHeight > window.innerWidth){
        body.classList.add('tall_window');
        body.classList.remove('wide_window');
    } else{
        body.classList.add('wide_window');
        body.classList.remove('tall_window');
    }
}
window.onresize = setWideMode;

function showHideMenu_(){
    let lastY = 0;
    return ()=>{
        let menu = document.getElementById('top_menu');
        if (window.scrollY < 200){
            console.log('Menu - inline');
            menu.classList.remove("fix","hide");
        }else if (window.scrollY > lastY){
            console.log('menu - hide');
            menu.classList.remove("fix");
            menu.classList.add("hide");
        } else{
            console.log('menu - fix');
            menu.classList.add("fix");
            menu.classList.remove("hide");
        }
        console.log("last,current",lastY,window.scrollY );

        lastY = window.scrollY;
    }
}

function setShowButtons(event){
    let body = document.getElementById('doc_body');
    show
}

window.onscroll = showHideMenu_();

setWideMode();
showHideMenu_()();

</script>

</html>
