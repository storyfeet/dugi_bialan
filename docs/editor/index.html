
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Write Dugi Bialan Script</title>


<link rel="stylesheet" href="/css/main.css">




</head>
<body id="doc_body">
    <div class="page_inner">
        <div id="top_menu" class="no-print menu">
            <a href="/">Home</a>
            <a href="/word_list">Word List</a>
            <a href="/grammar">Grammar</a>
            <a href="/grammar_faq">Grammar Faq</a>
            <a href="/phonology">Phonology</a>
            <a href="/works">Works</a>
            <a href="/dictionary">Dictionary</a>
        </div><div class="title_box">
            <img src="/pics/squares/dugibelan-1.svg">
            <h1>Write Dugi Bialan Script</h1>
        </div><div class="content">
            
<textarea id="roman">
</textarea>
<div id="dugi"><div>

<script type="module">

	function showDugi(s,len){
		let s2 = decodeString(s,len);
	    let op = document.getElementById("dugi");
		op.innerText = s2;
	}

	function whenReady(){
		let tx = document.getElementById("roman");
		tx.addEventListener("input",(ob)=>{
			let s = ob.target.value;
			if (s==""){
				let op = document.getElementById("dugi");
				op.innerText = "";
				return;
			}
			//console.log("Input:",s);
			let sdat = encodeString(s);
			w_dugi.exports.convert(sdat.s,sdat.l);
		});
	}


	var memory = new WebAssembly.Memory({
		initial:2,
		maximum:100,
	});
	let forImport = {
		dugi:{
	//		qlog:(s,len)=>console.log(arg),
			show_dugi:showDugi
		},
		env: {
			memory:memory,
		}
	};

	(async ()=>{
		let response = await fetch("wasm/dugi.wasm");
		let buf	= await response.arrayBuffer();
		let ob = await WebAssembly.instantiate(buf,forImport);
		window.w_dugi = ob.instance; 
		w_dugi.exports.init();
		whenReady();
	})();



	const decodeString = (pointer, length) => {
	  const slice = new Uint8Array(
		w_dugi.exports.memory.buffer, // memory exported from Zig
		pointer,
		length
	  );
	  return new TextDecoder().decode(slice);
	};

	const encodeString = (string) => {
	  const buffer = new TextEncoder().encode(string);
	  const pointer = w_dugi.exports.allocUint8(buffer.length + 1); // ask Zig to allocate memory
	  //console.log("Pre Slice");
	  const slice = new Uint8Array(
		w_dugi.exports.memory.buffer, // memory exported from Zig
		pointer,
		buffer.length + 1
	  );
	  //console.log("post slice");
	  slice.set(buffer);
	  slice[buffer.length] = 0; // null byte to null-terminate the string
	  return {s:pointer,l:buffer.length};
	};

</script>

        </div>
    </div>

</body>

<script type="module">

function setWideMode(){
    let body = document.getElementById('doc_body');
    if (window.innerHeight > window.innerWidth){
        body.classList.add('tall_window');
        body.classList.remove('wide_window');
    } else{
        body.classList.add('wide_window');
        body.classList.remove('tall_window');
    }
}
window.onresize = setWideMode;

function showHideMenu_(){
    let lastY = 0;
    return ()=>{
        let menu = document.getElementById('top_menu');
        if (window.scrollY < 200){
            console.log('Menu - inline');
            menu.classList.remove("fix","hide");
        }else if (window.scrollY > lastY){
            console.log('menu - hide');
            menu.classList.remove("fix");
            menu.classList.add("hide");
        } else{
            console.log('menu - fix');
            menu.classList.add("fix");
            menu.classList.remove("hide");
        }
        console.log("last,current",lastY,window.scrollY );

        lastY = window.scrollY;
    }
}

function setShowButtons(event){
    let body = document.getElementById('doc_body');
    show
}

window.onscroll = showHideMenu_();

setWideMode();
showHideMenu_()();

</script>

</html>
